!function(t,e){"use strict";function i(){var t=z.outerWidth(),e=z.outerHeight();z.attr({width:t,height:e}),b.requireRedraw()}t="default"in t?t.default:t,e="default"in e?e.default:e;var a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),s=120,r=50,o=s/2,h=r/2,l="24px serif",u=!1,c=function(){function t(){a(this,t),this.canvas=document.createElement("canvas"),this.canvas.width=s,this.canvas.height=r;var e=this.canvas.getContext("2d");e.textBaseline="middle",e.textAlign="center",e.font=l,e.shadowColor="#0077FF",e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=7,e.strokeStyle="#33FFFF",e.strokeText("IceMaze",o,h),e.fillStyle="white",e.fillText("IceMaze",o,h),u&&(e.strokeStyle="green",e.strokeRect(0,0,s,r))}return n(t,[{key:"draw",value:function(t){t.getContext("2d").drawImage(this.canvas,0,t.height-r)}}]),t}(),d=new c,p=9,f=61,v=1e3/60,w=250,g=100,y=!1,k=function(){function t(e){a(this,t),this.canvas=e,this.targetX=0,this.targetY=0,this.panX=0,this.panY=0,this.tileSize=21,this.redrawRequired=!1,this.lastRedrawTime=0,this.preDrawCallbacks=[],this.postDrawCallbacks=[],this.requireRedraw()}return n(t,[{key:"getTileCoords",value:function(t){var e=t.x,i=t.y;return{x:Math.round((e-this.canvas.width/2+this.panX*this.tileSize)/this.tileSize),y:Math.round((this.canvas.height/2-i+this.panY*this.tileSize)/this.tileSize)}}},{key:"getCanvasCoords",value:function(t){var e=t.x,i=t.y;return{x:e*this.tileSize-this.panX*this.tileSize+this.canvas.width/2-this.tileSize/2,y:-(i*this.tileSize-this.panY*this.tileSize-this.canvas.height/2)-this.tileSize/2}}},{key:"getVisibleRect",value:function(){var t=this.getTileCoords({x:0,y:this.canvas.height});return{x:t.x,y:t.y,w:Math.ceil(this.canvas.width/this.tileSize),h:Math.ceil(this.canvas.height/this.tileSize)}}},{key:"fillTile",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blue",i=this.getCanvasCoords(t),a=i.x,n=i.y,s=this.canvas.getContext("2d");s.fillStyle=e,s.fillRect(a,n,this.tileSize,this.tileSize)}},{key:"zoom",value:function(t){this.zoomTo(this.tileSize*t)}},{key:"freeZoom",value:function(t){var e=Math.round(this.tileSize*t);e%2===0&&(e+=1),e<p?e=p:e>f&&(e=f),this.tileSize=e,this.requireRedraw()}},{key:"zoomTo",value:function(t,e){if(t=Math.round(t),t%2===0&&(t+=1),t<p?t=p:t>f&&(t=f),this.preDrawCallbacks=this.preDrawCallbacks.filter(function(t){return!t.zoomStepper}),t===this.tileSize)return void("function"==typeof e&&e());var i=this.tileSize,a=t-i,n=(new Date).getTime(),s=function(){var t=(this.lastRedrawTime-n)/w;t<0?t=0:t>1&&(t=1),this.tileSize=i+t*a,t<1?this.requireRedraw(s):(console.log("tile size",this.tileSize),this.zoomInProgress=!1,this.requireRedraw(),"function"==typeof e&&e())}.bind(this);s.zoomStepper=!0,this.requireRedraw(s)}},{key:"panUp",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.panTo({y:this.targetY+Math.round(t)})}},{key:"panRight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.panTo({x:this.targetX+Math.round(t)})}},{key:"panDown",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.panTo({y:this.targetY-Math.round(t)})}},{key:"panLeft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.panTo({x:this.targetX-Math.round(t)})}},{key:"freePan",value:function(t,e){this.panX-=t/this.tileSize,this.panY+=e/this.tileSize,this.requireRedraw()}},{key:"panCenter",value:function(){this.panTo({x:this.panX,y:this.panY})}},{key:"panTo",value:function(t,e){var i=t.x,a=void 0===i?this.targetX:i,n=t.y,s=void 0===n?this.targetY:n;if(this.targetX=Math.round(a),this.targetY=Math.round(s),this.preDrawCallbacks=this.preDrawCallbacks.filter(function(t){return!t.panStepper}),this.targetX===this.panX&&this.targetY===this.panY)return void("function"==typeof e&&e());var r=this.panX,o=this.panY,h=this.targetX-r,l=this.targetY-o,u=Math.sqrt(h*h+l*l),c=u*g,d=(new Date).getTime(),p=function(){var t=(this.lastRedrawTime-d)/c;t<0&&(t=0),t<1?(this.panX=r+t*h,this.panY=o+t*l,this.requireRedraw(p)):(this.panX=this.targetX,this.panY=this.targetY,console.log("pan center",this.panX,this.panY),this.requireRedraw(),"function"==typeof e&&e())}.bind(this);p.panStepper=!0,this.requireRedraw(p)}},{key:"requireRedraw",value:function(t,e){if("function"==typeof t&&this.preDrawCallbacks.push(t),"function"==typeof e&&this.postDrawCallbacks.push(e),!this.redrawRequired)if(this.redrawRequired=!0,window.requestAnimationFrame)window.requestAnimationFrame(this.redraw.bind(this));else{var i=v-((new Date).getTime()-this.lastRedrawTime);window.setTimeout(this.redraw.bind(this),i>0?i:0)}}},{key:"redraw",value:function(){this.redrawRequired=!1,this.lastRedrawTime=(new Date).getTime();var t=this.preDrawCallbacks;this.preDrawCallbacks=[],t.forEach(function(t){t()}),this.drawGrid(),d.draw(this.canvas),this.fillTile({x:0,y:0});var e=this.postDrawCallbacks;this.postDrawCallbacks=[],e.forEach(function(t){t()})}},{key:"drawGrid",value:function(){var t=this.canvas.width,e=this.canvas.height,i=this.tileSize,a=this.canvas.getContext("2d");a.clearRect(0,0,t,e),y&&(a.lineWidth=1,a.strokeStyle="green",a.strokeRect(0,0,t,e)),a.beginPath();for(var n=(t-i)/2%i-i*(this.panX%1);n<t;n+=i)a.moveTo(n,0),a.lineTo(n,e);for(var s=(e-i)/2%i+i*(this.panY%1);s<e;s+=i)a.moveTo(0,s),a.lineTo(t,s);a.closePath(),a.lineWidth=1,a.strokeStyle="rgba(0,0,0,.2)",a.stroke()}}]),t}(),m=function(){function t(e,i){a(this,t),this.grid=[],this.width=Math.round(e),this.height=Math.round(i)}return n(t,[{key:"get",value:function(t,e,i){t=t<0?this.width+t%this.width:t%this.width,e=e<0?this.height+e%this.height:e%this.height;var a=this.grid[e]||(this.grid[e].cellCount=0,this.grid[e]=[]),n=a[t]||(a.cellCount++,a[t]={});return i?n[i]:n}},{key:"toggle",value:function(t,e,i,a){var n=this.get(t,e);return n[i]=void 0===a?!n[i]:a}},{key:"clear",value:function(t,e){t=t<0?this.width+t%this.width:t%this.width,e=e<0?this.height+e%this.height:e%this.height;var i=this.grid[e];i&&i[t]&&(t>=0?i.splice(t,1):i[t]=void 0,i.cellCount--,0===i.cellCount&&(e>=0?this.grid.splice(e,1):this.grid[e]=void 0))}}]),t}(),z=t("canvas"),S=z[0],b=(new m(100,100),new k(S));window.view=b,t.notify.addStyle("plain",{html:"<div><span data-notify-text/></div>",classes:{base:{"white-space":"nowrap","background-color":"lightblue",padding:"5px","text-align":"right"},error:{},success:{},info:{},warning:{}}}),t.notify.defaults({style:"plain"});var T=new e.Manager(z[0],{recognizers:[[e.Pan],[e.Tap],[e.Tap,{event:"doubletap",taps:2},["tap"]],[e.Press],[e.Pinch]]}),C=void 0;T.on("panstart panmove",function(t){"panstart"===t.type&&(C={x:0,y:0}),console.log(t.type,t),b.freePan(t.deltaX-C.x,t.deltaY-C.y),C.x=t.deltaX,C.y=t.deltaY}),T.on("panend",function(e){t.notify(e.type),b.panCenter()});var x=void 0;T.on("pinchmove",function(t){"pinchstart"===t.type&&(x=1),b.freeZoom(1-(t.scale-x)/10),x=t.scale}),T.on("tap",function(e){t.notify(e.type);var i=b.getTileCoords(e.center),a=i.x,n=i.y;t.notify("tap ("+a+", "+n+")"),console.log("tap",a,n)}),T.on("doubletap",function(t){console.log(t.type,arguments)}),T.on("press",function(t){console.log(t.type,arguments)}),Mousetrap.bind("up",function(){b.panUp()}),Mousetrap.bind("right",function(){b.panRight()}),Mousetrap.bind("down",function(){b.panDown()}),Mousetrap.bind("left",function(){b.panLeft()}),Mousetrap.bind("enter",function(){b.panCenter()}),t(window).on("mousewheel",function(t){b.freeZoom(t.deltaY<0?1.1:.9)}),i();var R;t(window).on("resize",function(){R&&clearTimeout(R),R=setTimeout(function(){R=null,i()},100)}),console.log("icemaze loaded!")}($,Hammer);
//# sourceMappingURL=compiled.js.map
