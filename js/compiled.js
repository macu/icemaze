!function(t,e){"use strict";function i(){var t=l.outerWidth(),e=l.outerHeight();l.attr({width:t,height:e}),d.requireRedraw()}t="default"in t?t.default:t,e="default"in e?e.default:e;var n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),r=9,o=61,s=1e3/60,h=250,u=100,p=function(){function t(e){n(this,t),this.canvas=e,this.targetX=0,this.targetY=0,this.panX=0,this.panY=0,this.tileSize=21,this.redrawRequired=!1,this.lastRedrawTime=0,this.preDrawCallbacks=[],this.postDrawCallbacks=[],this.requireRedraw()}return a(t,[{key:"zoom",value:function(t){this.zoomTo(this.tileSize*t)}},{key:"zoomTo",value:function(t,e){if(t=Math.round(t),t%2===0&&(t+=1),t<r?t=r:t>o&&(t=o),this.preDrawCallbacks=this.preDrawCallbacks.filter(function(t){return!t.zoomStepper}),t===this.tileSize)return void("function"==typeof e&&e());var i=this.tileSize,n=t-i,a=(new Date).getTime(),s=function(){var t=(this.lastRedrawTime-a)/h;t<0?t=0:t>1&&(t=1),this.tileSize=i+t*n,t<1?this.requireRedraw(s):(console.log("tile size",this.tileSize),this.zoomInProgress=!1,this.requireRedraw(),"function"==typeof e&&e())}.bind(this);s.zoomStepper=!0,this.requireRedraw(s)}},{key:"panUp",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.panTo({y:this.targetY-Math.round(t)})}},{key:"panRight",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.panTo({x:this.targetX+Math.round(t)})}},{key:"panDown",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.panTo({y:this.targetY+Math.round(t)})}},{key:"panLeft",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.panTo({x:this.targetX-Math.round(t)})}},{key:"panStop",value:function(){this.preDrawCallbacks.some(function(t){return t.panStepper})&&this.panTo({x:this.panX,y:this.panY})}},{key:"panTo",value:function(t,e){var i=t.x,n=void 0===i?this.targetX:i,a=t.y,r=void 0===a?this.targetY:a;if(this.targetX=Math.round(n),this.targetY=Math.round(r),this.preDrawCallbacks=this.preDrawCallbacks.filter(function(t){return!t.panStepper}),this.targetX===this.panX&&this.targetY===this.panY)return void("function"==typeof e&&e());var o=this.panX,s=this.panY,h=this.targetX-o,p=this.targetY-s,l=Math.sqrt(h*h+p*p),c=l*u,d=(new Date).getTime(),f=function(){var t=(this.lastRedrawTime-d)/c;t<0&&(t=0),t<1?(this.panX=o+t*h,this.panY=s+t*p,this.requireRedraw(f)):(this.panX=this.targetX,this.panY=this.targetY,console.log("pan center",this.panX,this.panY),this.requireRedraw(),"function"==typeof e&&e())}.bind(this);f.panStepper=!0,this.requireRedraw(f)}},{key:"requireRedraw",value:function(t,e){if("function"==typeof t&&this.preDrawCallbacks.push(t),"function"==typeof e&&this.postDrawCallbacks.push(e),!this.redrawRequired)if(this.redrawRequired=!0,window.requestAnimationFrame)window.requestAnimationFrame(this.redraw.bind(this));else{var i=s-((new Date).getTime()-this.lastRedrawTime);window.setTimeout(this.redraw.bind(this),i>0?i:0)}}},{key:"redraw",value:function(){this.redrawRequired=!1,this.lastRedrawTime=(new Date).getTime();var t=this.preDrawCallbacks;this.preDrawCallbacks=[],t.forEach(function(t){t()}),this.drawGrid();var e=this.postDrawCallbacks;this.postDrawCallbacks=[],e.forEach(function(t){t()})}},{key:"drawGrid",value:function(){var t=this.canvas.width,e=this.canvas.height,i=this.tileSize,n=this.canvas.getContext("2d");n.clearRect(0,0,t,e),n.lineWidth=1,n.strokeStyle="blue",n.strokeRect(0,0,t,e),n.beginPath();for(var a=(t-i)/2%i-i*(this.panX%1);a<t;a+=i)n.moveTo(a,0),n.lineTo(a,e);for(var r=(e-i)/2%i-i*(this.panY%1);r<e;r+=i)n.moveTo(0,r),n.lineTo(t,r);n.closePath(),n.lineWidth=1,n.strokeStyle="rgba(0,0,0,.2)",n.stroke()}}]),t}(),l=(function(){function t(){n(this,t),this.grid={}}return a(t,[{key:"get",value:function(t,e){return(this.grid[t]||{})[e]}},{key:"toggle",value:function(t,e){var i=this.grid[t]||(this.grid[t]={});return i[e]=!i[e],i[e]}}]),t}(),t("canvas")),c=l[0],d=new p(c);window.canvasview=d;var f=new e.Manager(l[0],{recognizers:[[e.Swipe],[e.Tap],[e.Tap,{event:"doubletap",taps:2},["tap"]],[e.Press],[e.Pinch]]});f.on("swipeup swiperight swipedown swipeleft",function(t){switch(t.type){case"swipeup":d.panDown();break;case"swiperight":d.panLeft();break;case"swipedown":d.panUp();break;case"swipeleft":d.panRight()}}),f.on("tap",function(t){d.panStop()}),f.on("doubletap",function(t){console.log(t.type,arguments)}),f.on("press",function(t){console.log(t.type,arguments)}),Mousetrap.bind("up",function(){d.panUp()}),Mousetrap.bind("right",function(){d.panRight()}),Mousetrap.bind("down",function(){d.panDown()}),Mousetrap.bind("left",function(){d.panLeft()}),Mousetrap.bind("enter",function(){d.panStop()}),f.on("pinchout",function(t){d.zoom(1.2)}),f.on("pinchin",function(t){d.zoom(.8)}),t(window).on("mousewheel",function(t){t.deltaY>0?d.zoom(1.2):t.deltaY&&d.zoom(.8)}),i();var w;t(window).on("resize",function(){w&&clearTimeout(w),w=setTimeout(function(){w=null,i()},100)}),console.log("icemaze loaded!")}($,Hammer);
//# sourceMappingURL=compiled.js.map
